<!-- 提取页面 -->
<main id="extraction-page" class="page-content">
    <div class="card">
        <h2><i class="fas fa-robot"></i> <span data-i18n="extract_model_config">Model Configuration</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractModelPath" data-i18n="model_path_label">Model Path</label>
                <input type="text" id="extractModelPath" data-i18n-placeholder="model_path_placeholder" placeholder="e.g., /path/to/Qwen2.5-1.5B-Instruct/">
            </div>
            
            <div class="form-group">
                <label for="extractGpuDevices" data-i18n="gpu_devices_label">GPU Device IDs</label>
                <input type="text" id="extractGpuDevices" data-i18n-placeholder="gpu_devices_placeholder" placeholder="e.g., 0,1,2 or single GPU: 0" value="0">
            </div>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-filter"></i> <span data-i18n="extract_method_config">Extraction Method</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractMethod" data-i18n="extract_method_label">Method Selection</label>
                <select id="extractMethod" onchange="updateExtractionMethodOptions()">
                    <option value="lat" data-i18n="extract_method_lat">LAT - Linear Algebraic Technique</option>
                    <option value="pca" data-i18n="extract_method_pca">PCA - Principal Component Analysis</option>
                    <option value="sae" data-i18n="extract_method_sae">SAE - Sparse Autoencoder</option>
                    <option value="diffmean" data-i18n="extract_method_diffmean">DiffMean - Mean Difference</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="extractTargetLayer" data-i18n="extract_target_layer_label">Target Layer</label>
                <input type="number" id="extractTargetLayer" min="0" max="50" placeholder="e.g., 8 (leave empty for all layers)">
                <small class="help-text" data-i18n="extract_target_layer_help">Specify a single layer index or leave empty to extract from all layers.</small>
            </div>
            
            <div class="form-group">
                <label for="extractTokenPos" data-i18n="extract_token_pos_label">Token Position</label>
                <select id="extractTokenPos">
                    <option value="-1" data-i18n="extract_token_last">Last Token</option>
                    <option value="first" data-i18n="extract_token_first">First Token</option>
                    <option value="mean" data-i18n="extract_token_mean">Mean of All Tokens</option>
                    <option value="max" data-i18n="extract_token_max">Max Norm Token</option>
                </select>
            </div>
        </div>
        
        <!-- Method-specific options -->
        <div id="saeOptions" style="display: none;">
            <div class="form-groups-container">
                <div class="form-group">
                    <label for="saeParamsPath" data-i18n="extract_sae_params_label">SAE Parameters Path</label>
                    <input type="text" id="saeParamsPath" placeholder="e.g., /path/to/sae_params.npz">
                    <small class="help-text" data-i18n="extract_sae_params_help">Path to the pre-trained SAE parameters file.</small>
                </div>
                
                <div class="form-group">
                    <label for="saeCombinationMode" data-i18n="extract_sae_combination_label">Feature Combination Mode</label>
                    <select id="saeCombinationMode">
                        <option value="weighted_all" data-i18n="extract_sae_weighted_all">Weighted All Features</option>
                        <option value="weighted_top_k" data-i18n="extract_sae_weighted_top_k">Weighted Top-K Features</option>
                        <option value="single_top_feature" data-i18n="extract_sae_single_top">Single Top Feature</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group" id="saeTopKGroup" style="display: none;">
                <label for="saeTopK" data-i18n="extract_sae_top_k_label">Top K Features</label>
                <input type="number" id="saeTopK" min="1" max="1000" value="100">
            </div>
        </div>
        
        <div class="form-group checkbox-group">
            <label>
                <input type="checkbox" id="extractNormalize" checked>
                <span data-i18n="extract_normalize_label">Normalize Vector</span>
            </label>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-database"></i> <span data-i18n="extract_data_config">Sample Data</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractPositiveSamples" data-i18n="extract_positive_samples_label">Positive Samples</label>
                <textarea id="extractPositiveSamples" rows="8" data-i18n-placeholder="extract_positive_samples_placeholder" placeholder='Enter positive samples (one per line):
I love puppies!
Dogs are wonderful companions.
My dog brings me so much joy.'></textarea>
                <small class="help-text" data-i18n="extract_positive_samples_help">Enter samples that represent the behavior/concept you want to enhance.</small>
            </div>
            
            <div class="form-group">
                <label for="extractNegativeSamples" data-i18n="extract_negative_samples_label">Negative Samples</label>
                <textarea id="extractNegativeSamples" rows="8" data-i18n-placeholder="extract_negative_samples_placeholder" placeholder='Enter negative samples (one per line):
The weather is nice today.
I need to buy groceries.
Mathematics is interesting.'></textarea>
                <small class="help-text" data-i18n="extract_negative_samples_help">Enter neutral samples that don't represent the target behavior/concept.</small>
            </div>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-save"></i> <span data-i18n="extract_output_config">Output Configuration</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractOutputPath" data-i18n="extract_output_path_label">Output File Path</label>
                <input type="text" id="extractOutputPath" placeholder="e.g., ./extracted_vectors/my_vector.safetensors" value="./extracted_vectors/control_vector.safetensors">
                <small class="help-text" data-i18n="extract_output_path_help">Path where the extracted control vector will be saved.</small>
            </div>
            
            <div class="form-group">
                <label for="extractVectorName" data-i18n="extract_vector_name_label">Vector Name</label>
                <input type="text" id="extractVectorName" placeholder="e.g., love_dogs_vector" value="extracted_vector">
            </div>
        </div>
    </div>

    <div class="card">
        <!-- 提取配置导入选择 -->
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractConfigSelect" data-i18n="config_select_label">Import Extraction Configuration</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="extractConfigSelect" style="flex: 1;">
                        <option value="" data-i18n="config_select_placeholder">-- Select an extraction configuration --</option>
                        <!-- 配置选项将通过JavaScript动态加载 -->
                    </select>
                    <button class="btn-secondary" onclick="importSelectedExtractConfig()">
                        <i class="fas fa-download"></i> <span data-i18n="import_config_btn">Import</span>
                    </button>
                </div>
                <small class="help-text" data-i18n="extract_config_select_help">Select and import a pre-configured extraction setup.</small>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="startExtraction()">
                <i class="fas fa-flask"></i> <span data-i18n="extract_start_btn">Extract Vector</span>
            </button>
            <button class="btn-secondary" onclick="resetExtractForm()">
                <i class="fas fa-redo"></i> <span data-i18n="reset_btn">Reset</span>
            </button>
            <button class="btn-warning" onclick="restartBackend()">
                <i class="fas fa-sync-alt"></i> <span data-i18n="restart_backend_btn">Restart Backend</span>
            </button>
        </div>
    </div>

    <div id="extractResponse" class="response-container" style="display: none;">
        <h3><i class="fas fa-check-circle"></i> <span data-i18n="extract_response_title">Extraction Result</span></h3>
        <div id="extractResponseContent"></div>
    </div>

    <div id="extractError" class="error-container" style="display: none;">
        <h3><i class="fas fa-exclamation-circle"></i> <span data-i18n="error_title">Error Message</span></h3>
        <pre id="extractErrorContent"></pre>
    </div>
</main> 