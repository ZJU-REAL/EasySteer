<!-- 提取页面 -->
<main id="extraction-page" class="page-content">
    <div class="card">
        <h2><i class="fas fa-robot"></i> <span data-i18n="extract_model_config">Model Configuration</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractModelPath" data-i18n="model_path_label">Model Path</label>
                <input type="text" id="extractModelPath" data-i18n-placeholder="model_path_placeholder" placeholder="e.g., /path/to/Qwen2.5-1.5B-Instruct/">
            </div>
            
            <div class="form-group">
                <label for="extractGpuDevices" data-i18n="gpu_devices_label">GPU Device IDs</label>
                <input type="text" id="extractGpuDevices" data-i18n-placeholder="gpu_devices_placeholder" placeholder="e.g., 0,1,2 or single GPU: 0" value="0">
            </div>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-filter"></i> <span data-i18n="extract_method_config">Extraction Method</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractMethod" data-i18n="extract_method_label">Method Selection</label>
                <select id="extractMethod" onchange="updateExtractionMethodOptions()">
                    <option value="diffmean" data-i18n="extract_method_diffmean">DiffMean - Mean Difference</option>
                    <option value="pca" data-i18n="extract_method_pca">PCA - Principal Component Analysis</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="extractTargetLayer" data-i18n="extract_target_layer_label">Target Layer</label>
                <input type="number" id="extractTargetLayer" min="0" max="50" placeholder="e.g., 8 (leave empty for all layers)">
                <small class="help-text" data-i18n="extract_target_layer_help">Specify a single layer index or leave empty to extract from all layers.</small>
            </div>
            
            <div class="form-group">
                <label for="extractTokenPos" data-i18n="extract_token_pos_label">Token Position</label>
                <input type="number" id="extractTokenPos" value="-1" placeholder="e.g., -1 for last token, 0 for first token">
                <small class="help-text" data-i18n="extract_token_pos_help">Use integer index: -1 for last token, 0 for first token, etc.</small>
            </div>
        </div>
        
        <!-- 移除了SAE特定选项，只保留DiffMean和PCA -->
        
        <div class="form-group checkbox-group">
            <label>
                <input type="checkbox" id="extractNormalize" checked>
                <span data-i18n="extract_normalize_label">Normalize Vector</span>
            </label>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-database"></i> <span data-i18n="extract_data_config">Sample Data</span></h2>
        <div class="sample-pairs-container">
            <div class="sample-pairs-header">
                <h3 data-i18n="extract_sample_pairs_label">Sample Pairs</h3>
                <button type="button" class="btn-primary add-sample-btn" onclick="addSamplePair()">
                    <i class="fas fa-plus"></i> <span data-i18n="add_sample_btn">Add Sample Pair</span>
                </button>
            </div>
            
            <!-- Hidden fields to store actual data -->
            <input type="hidden" id="extractPositiveSamples">
            <input type="hidden" id="extractNegativeSamples">
            
            <!-- Sample pairs will be dynamically added here -->
            <div id="samplePairsList" class="sample-pairs-list">
                <div class="empty-samples-message" data-i18n="no_samples_message">No sample pairs added yet. Click "Add Sample Pair" to add your first pair.</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-save"></i> <span data-i18n="extract_output_config">Output Configuration</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractOutputPath" data-i18n="extract_output_path_label">Output File Path</label>
                <input type="text" id="extractOutputPath" placeholder="e.g., ./extracted_vectors/my_vector.gguf" value="./extracted_vectors/control_vector.gguf">
                <small class="help-text" data-i18n="extract_output_path_help">Path where the extracted control vector will be saved.</small>
            </div>
            
            <div class="form-group">
                <label for="extractVectorName" data-i18n="extract_vector_name_label">Vector Name</label>
                <input type="text" id="extractVectorName" placeholder="e.g., love_dogs_vector" value="extracted_vector">
            </div>
        </div>
    </div>

    <div class="card">
        <!-- 提取配置导入选择 -->
        <div class="form-groups-container">
            <div class="form-group">
                <label for="extractConfigSelect" data-i18n="config_select_label">Import Extraction Configuration</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="extractConfigSelect" style="flex: 1;">
                        <option value="" data-i18n="config_select_placeholder">-- Select an extraction configuration --</option>
                        <!-- 配置选项将通过JavaScript动态加载 -->
                    </select>
                    <button class="btn-secondary" onclick="importSelectedExtractConfig()">
                        <i class="fas fa-download"></i> <span data-i18n="import_config_btn">Import</span>
                    </button>
                </div>
                <small class="help-text" data-i18n="extract_config_select_help">Select and import a pre-configured extraction setup.</small>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="startExtraction()">
                <i class="fas fa-flask"></i> <span data-i18n="extract_start_btn">Extract Vector</span>
            </button>
            <button class="btn-secondary" onclick="resetExtractForm()">
                <i class="fas fa-redo"></i> <span data-i18n="reset_btn">Reset</span>
            </button>
            <button class="btn-warning" onclick="restartBackend()">
                <i class="fas fa-sync-alt"></i> <span data-i18n="restart_backend_btn">Restart Backend</span>
            </button>
        </div>
    </div>

    <div id="extractResponse" class="response-container" style="display: none;">
        <h3><i class="fas fa-check-circle"></i> <span data-i18n="extract_response_title">Extraction Result</span></h3>
        <div id="extractResponseContent"></div>
    </div>

    <div id="extractError" class="error-container" style="display: none;">
        <h3><i class="fas fa-exclamation-circle"></i> <span data-i18n="error_title">Error Message</span></h3>
        <pre id="extractErrorContent"></pre>
    </div>
    
    <!-- Template for new sample pair -->
    <template id="samplePairTemplate">
        <div class="sample-pair-item">
            <div class="sample-header">
                <span class="sample-number"></span>
                <button type="button" class="btn-danger remove-sample-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="sample-content">
                <div class="sample-positive">
                    <label data-i18n="sample_positive_label">Positive Sample:</label>
                    <textarea class="sample-positive-text" rows="3" onchange="updateSamplePairs()" data-i18n-placeholder="sample_positive_placeholder" placeholder="Enter positive sample text..."></textarea>
                </div>
                <div class="sample-negative">
                    <label data-i18n="sample_negative_label">Negative Sample:</label>
                    <textarea class="sample-negative-text" rows="3" onchange="updateSamplePairs()" data-i18n-placeholder="sample_negative_placeholder" placeholder="Enter negative sample text..."></textarea>
                </div>
            </div>
        </div>
    </template>
</main> 