<!-- 推理页面 -->
<main id="inference-page" class="page-content active">
    <!-- 子导航 -->
    <div class="sub-nav">
        <button class="sub-nav-btn active" onclick="switchInferenceMode('single')" data-i18n="single_vector_mode">
            <i class="fas fa-vector-square"></i> Single Vector
        </button>
        <button class="sub-nav-btn" onclick="switchInferenceMode('multi')" data-i18n="multi_vector_mode">
            <i class="fas fa-layer-group"></i> Multi Vector
        </button>
    </div>

    <!-- 单向量控制模式 -->
    <div id="single-vector-mode" class="inference-mode active">
        <div class="card">
            <h2><i class="fas fa-robot"></i> <span data-i18n="model_config">Model & Sampling Configuration</span></h2>
            <div class="form-groups-container">
                <div class="form-group">
                    <label for="modelPath" data-i18n="model_path_label">Model Path</label>
                    <input type="text" id="modelPath" data-i18n-placeholder="model_path_placeholder" placeholder="e.g., /path/to/Qwen2.5-1.5B-Instruct/">
                </div>
                
                <div class="form-group">
                    <label for="gpuDevices" data-i18n="gpu_devices_label">GPU Device IDs</label>
                    <input type="text" id="gpuDevices" data-i18n-placeholder="gpu_devices_placeholder" placeholder="e.g., 0,1,2 or single GPU: 0" value="0">
                </div>
                
                <div class="form-group">
                    <label for="temperature" data-i18n="temperature_label">Temperature</label>
                    <div class="slider-container">
                        <input type="range" id="temperatureSlider" min="0" max="2" step="0.1" value="0.0">
                        <input type="number" id="temperature" min="0" max="2" step="0.1" value="0.0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="maxTokens" data-i18n="max_tokens_label">Max Tokens</label>
                    <input type="number" id="maxTokens" min="1" max="4096" value="128">
                </div>
                
                <div class="form-group">
                    <label for="repetitionPenalty" data-i18n="repetition_penalty_label">Repetition Penalty</label>
                    <div class="slider-container">
                        <input type="range" id="repetitionPenaltySlider" min="1" max="2" step="0.1" value="1.1">
                        <input type="number" id="repetitionPenalty" min="1" max="2" step="0.1" value="1.1">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-cog"></i> <span data-i18n="basic_config">Steer Vector Configuration</span></h2>
            <div class="form-groups-container">
                <div class="form-group">
                    <label for="steerVectorName" data-i18n="sv_name_label">Steer Vector Name</label>
                    <input type="text" id="steerVectorName" data-i18n-placeholder="sv_name_placeholder" placeholder="Enter steer vector name">
                </div>
                
                <div class="form-group">
                    <label for="steerVectorId" data-i18n="sv_id_label">Steer Vector ID</label>
                    <div class="id-normalize-container">
                        <input type="number" id="steerVectorId" data-i18n-placeholder="sv_id_placeholder" placeholder="Enter unique ID">
                        <label class="inline-checkbox">
                            <input type="checkbox" id="normalizeSV">
                            <span data-i18n="normalize_sv_label">Normalize Steer Vector</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="localPath" data-i18n="file_path_label">Local File Path</label>
                    <div class="file-input-wrapper">
                        <input type="text" id="localPath" placeholder="/path/to/steer_vector.safetensors">
                        <button class="btn-secondary" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-folder-open"></i>
                        </button>
                        <input type="file" id="fileInput" style="display: none;" accept=".safetensors,.pt,.bin,.gguf">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="scale" data-i18n="scale_factor_label">Scale Factor</label>
                    <div class="slider-container">
                        <input type="range" id="scaleSlider" min="-5" max="5" step="0.1" value="1.0">
                        <input type="number" id="scale" min="-5" max="5" step="0.1" value="1.0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="algorithm" data-i18n="algorithm_label">Algorithm Selection</label>
                    <select id="algorithm">
                        <option value="direct" data-i18n="algorithm_direct">Direct Algorithm</option>
                        <option value="loreft" data-i18n="algorithm_loreft">LoReft (Low-rank Linear Subspace Representation Finetuning)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="targetLayers" data-i18n="target_layers_label">Target Layers</label>
                    <input type="text" id="targetLayers" data-i18n-placeholder="target_layers_placeholder" placeholder="e.g., 0,1,2,3 or leave empty to apply to all layers">
                    <small class="help-text" data-i18n="target_layers_help">Enter layer indices separated by commas. Leave empty to apply to all layers.</small>
                </div>
                
            </div>
            
            <div class="triggers-row">
                <div class="triggers-column">
                    <label for="prefillTriggerTokens" data-i18n="prefill_tokens_label">Prefill Trigger Token IDs</label>
                    <input type="text" id="prefillTriggerTokens" data-i18n-placeholder="prefill_tokens_placeholder" placeholder="e.g., 100,200,300 or -1 to apply to all">
                    <small class="help-text" data-i18n="prefill_tokens_help">Enter token IDs separated by commas. Use -1 to apply to all tokens.</small>
                </div>
                
                <div class="triggers-column">
                    <label for="prefillTriggerPositions" data-i18n="prefill_positions_label">Prefill Trigger Positions</label>
                    <input type="text" id="prefillTriggerPositions" data-i18n-placeholder="prefill_positions_placeholder" placeholder="e.g., 0,1,-1 (supports negative indexing)">
                    <small class="help-text" data-i18n="prefill_positions_help">Enter position indices separated by commas. Supports negative indexing (-1 for last position).</small>
                </div>
                
                <div class="triggers-column">
                    <label for="generateTriggerTokens" data-i18n="generate_tokens_label">Generate Trigger Token IDs</label>
                    <input type="text" id="generateTriggerTokens" data-i18n-placeholder="generate_tokens_placeholder" placeholder="e.g., 400,500,600 or -1 to apply to all">
                    <small class="help-text" data-i18n="generate_tokens_help">Enter token IDs separated by commas. Use -1 to apply to all tokens.</small>
                </div>
            </div>
        </div>

        <div class="card">
            <!-- 配置导入选择 -->
            <div class="config-import-section">
                <label for="configSelect" data-i18n="config_select_label">Import Configuration</label>
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                    <select id="configSelect" style="flex: 1;">
                        <option value="" data-i18n="config_select_placeholder">-- Select a configuration --</option>
                        <!-- 配置选项将通过JavaScript动态加载 -->
                    </select>
                    <button class="btn-secondary" onclick="importSelectedConfig()">
                        <i class="fas fa-download"></i> <span data-i18n="import_config_btn">Import</span>
                    </button>
                </div>
                <small class="help-text" data-i18n="config_select_help">Select and import a pre-configured steer vector setup.</small>
            </div>
            
            <div class="form-group instruction-box">
                <label for="instruction" data-i18n="instruction_label">Input Instruction</label>
                <textarea id="instruction" rows="3" data-i18n-placeholder="instruction_placeholder" placeholder="Enter your prompt or question"></textarea>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="submitConfiguration()">
                    <i class="fas fa-paper-plane"></i> <span data-i18n="submit_btn">Generate</span>
                </button>
                <button class="btn-secondary" onclick="resetForm()">
                    <i class="fas fa-redo"></i> <span data-i18n="reset_btn">Reset</span>
                </button>

                <button class="btn-warning" onclick="restartBackend()">
                    <i class="fas fa-sync-alt"></i> <span data-i18n="restart_backend_btn">Restart Backend</span>
                </button>
            </div>
        </div>

        <div id="response" class="response-container" style="display: none;">
            <h3><i class="fas fa-check-circle"></i> <span data-i18n="response_title">Generation Result</span></h3>
            <div id="responseContent"></div>
        </div>

        <div id="error" class="error-container" style="display: none;">
            <h3><i class="fas fa-exclamation-circle"></i> <span data-i18n="error_title">Error Message</span></h3>
            <pre id="errorContent"></pre>
        </div>
    </div>

    <!-- 多向量控制模式 -->
    <div id="multi-vector-mode" class="inference-mode" style="display: none;">
        <div class="card">
            <h2><i class="fas fa-robot"></i> <span data-i18n="model_config">Model & Sampling Configuration</span></h2>
            <div class="form-groups-container">
                <div class="form-group">
                    <label for="multiModelPath" data-i18n="model_path_label">Model Path</label>
                    <input type="text" id="multiModelPath" data-i18n-placeholder="model_path_placeholder" placeholder="e.g., /path/to/Qwen2.5-1.5B-Instruct/">
                </div>
                
                <div class="form-group">
                    <label for="multiGpuDevices" data-i18n="gpu_devices_label">GPU Device IDs</label>
                    <input type="text" id="multiGpuDevices" data-i18n-placeholder="gpu_devices_placeholder" placeholder="e.g., 0,1,2 or single GPU: 0" value="0">
                </div>
                
                <div class="form-group">
                    <label for="multiTemperature" data-i18n="temperature_label">Temperature</label>
                    <div class="slider-container">
                        <input type="range" id="multiTemperatureSlider" min="0" max="2" step="0.1" value="0.0">
                        <input type="number" id="multiTemperature" min="0" max="2" step="0.1" value="0.0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="multiMaxTokens" data-i18n="max_tokens_label">Max Tokens</label>
                    <input type="number" id="multiMaxTokens" min="1" max="4096" value="128">
                </div>
                
                <div class="form-group">
                    <label for="multiRepetitionPenalty" data-i18n="repetition_penalty_label">Repetition Penalty</label>
                    <div class="slider-container">
                        <input type="range" id="multiRepetitionPenaltySlider" min="1" max="2" step="0.1" value="1.1">
                        <input type="number" id="multiRepetitionPenalty" min="1" max="2" step="0.1" value="1.1">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-cog"></i> <span data-i18n="basic_config">Steer Vector Configuration</span></h2>
            <div class="form-groups-container">
                <div class="form-group">
                    <label for="multiSteerVectorName" data-i18n="sv_name_label">Steer Vector Name</label>
                    <input type="text" id="multiSteerVectorName" data-i18n-placeholder="sv_name_placeholder" placeholder="Enter steer vector name">
                </div>
                
                <div class="form-group">
                    <label for="multiSteerVectorId" data-i18n="sv_id_label">Steer Vector ID</label>
                    <input type="number" id="multiSteerVectorId" data-i18n-placeholder="sv_id_placeholder" placeholder="Enter unique ID">
                </div>
                
                <div class="form-group">
                    <label for="conflictResolution" data-i18n="conflict_resolution_label">Conflict Resolution Method</label>
                    <select id="conflictResolution">
                        <option value="sequential" data-i18n="conflict_sequential">Sequential (Apply in order)</option>
                        <option value="priority" data-i18n="conflict_priority">Priority (Use first vector)</option>
                        <option value="error" data-i18n="conflict_error">Error (Disallow conflicts)</option>
                    </select>
                </div>
            </div>
            
            <!-- 向量配置列表 -->
            <div class="vector-configs" id="vectorConfigsList">
                <!-- 标签页导航 -->
                <div class="vector-tabs" id="vectorTabs">
                    <!-- 动态添加的标签页会显示在这里 -->
                </div>
                
                <!-- 标签页内容区 -->
                <div class="vector-tab-contents" id="vectorTabContents">
                    <!-- 动态添加的标签页内容会显示在这里 -->
                </div>
            </div>
            
            <!-- 添加新向量按钮 -->
            <button class="btn-add-vector" onclick="addVectorConfig()">
                <i class="fas fa-plus"></i> <span data-i18n="add_vector_btn">Add Vector Configuration</span>
            </button>
            
        </div>

        <div class="card">
            <!-- 配置导入选择 -->
            <div class="config-import-section">
                <label for="multiConfigSelect" data-i18n="config_select_label">Import Configuration</label>
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                    <select id="multiConfigSelect" style="flex: 1;">
                        <option value="" data-i18n="config_select_placeholder">-- Select a configuration --</option>
                        <!-- 配置选项将通过JavaScript动态加载 -->
                    </select>
                    <button class="btn-secondary" onclick="importSelectedMultiConfig()">
                        <i class="fas fa-download"></i> <span data-i18n="import_config_btn">Import</span>
                    </button>
                </div>
                <small class="help-text" data-i18n="config_select_help">Select and import a pre-configured steer vector setup.</small>
            </div>
            
            <div class="form-group instruction-box">
                <label for="multiInstruction" data-i18n="instruction_label">Input Instruction</label>
                <textarea id="multiInstruction" rows="3" data-i18n-placeholder="instruction_placeholder" placeholder="Enter your prompt or question"></textarea>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="submitMultiConfiguration()">
                    <i class="fas fa-paper-plane"></i> <span data-i18n="submit_btn">Generate</span>
                </button>
                <button class="btn-secondary" onclick="resetMultiForm()">
                    <i class="fas fa-redo"></i> <span data-i18n="reset_btn">Reset</span>
                </button>
                <button class="btn-warning" onclick="restartBackend()">
                    <i class="fas fa-sync-alt"></i> <span data-i18n="restart_backend_btn">Restart Backend</span>
                </button>
            </div>
        </div>

        <div id="multiResponse" class="response-container" style="display: none;">
            <h3><i class="fas fa-check-circle"></i> <span data-i18n="response_title">Generation Result</span></h3>
            <div id="multiResponseContent"></div>
        </div>

        <div id="multiError" class="error-container" style="display: none;">
            <h3><i class="fas fa-exclamation-circle"></i> <span data-i18n="error_title">Error Message</span></h3>
            <pre id="multiErrorContent"></pre>
        </div>
    </div>
</main> 