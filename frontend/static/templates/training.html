<!-- 训练页面 -->
<main id="training-page" class="page-content">
    <div class="card">
        <h2><i class="fas fa-robot"></i> <span data-i18n="train_model_config">Training Model Configuration</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="trainModelPath" data-i18n="model_path_label">Model Path</label>
                <input type="text" id="trainModelPath" data-i18n-placeholder="model_path_placeholder" placeholder="e.g., /path/to/Qwen2.5-1.5B-Instruct/">
            </div>
            
            <div class="form-group">
                <label for="trainGpuDevices" data-i18n="gpu_devices_label">GPU Device IDs</label>
                <input type="text" id="trainGpuDevices" data-i18n-placeholder="gpu_devices_placeholder" placeholder="e.g., 0,1,2 or single GPU: 0" value="0">
            </div>
            
            <div class="form-group">
                <label for="outputDir" data-i18n="train_output_dir_label">Output Directory</label>
                <input type="text" id="outputDir" data-i18n-placeholder="train_output_dir_placeholder" placeholder="e.g., ./results/my_training" value="./results/loreft">
            </div>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-cogs"></i> <span data-i18n="train_reft_config">ReFT Configuration</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="trainLayer" data-i18n="train_layer_label">Target Layer</label>
                <input type="number" id="trainLayer" min="0" max="50" value="8" placeholder="8">
                <small class="help-text" data-i18n="train_layer_help">Layer index where the intervention will be applied.</small>
            </div>
            
            <div class="form-group">
                <label for="trainComponent" data-i18n="train_component_label">Component</label>
                <select id="trainComponent">
                    <option value="block_output" data-i18n="train_component_block_output">Block Output</option>
                    <option value="attention_output" data-i18n="train_component_attention_output">Attention Output</option>
                    <option value="mlp_output" data-i18n="train_component_mlp_output">MLP Output</option>
                </select>
                <small class="help-text" data-i18n="train_component_help">The component of the layer to apply intervention.</small>
            </div>
            
            <div class="form-group">
                <label for="lowRankDim" data-i18n="train_low_rank_dim_label">Low Rank Dimension</label>
                <input type="number" id="lowRankDim" min="1" max="128" value="4" placeholder="4">
                <small class="help-text" data-i18n="train_low_rank_dim_help">Dimension of the low-rank adaptation. Lower values use less memory.</small>
            </div>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-graduation-cap"></i> <span data-i18n="train_params_config">Training Parameters</span></h2>
        <div class="form-groups-container">
            <div class="form-group">
                <label for="numEpochs" data-i18n="train_epochs_label">Number of Epochs</label>
                <input type="number" id="numEpochs" min="1" max="1000" value="100" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="batchSize" data-i18n="train_batch_size_label">Batch Size</label>
                <input type="number" id="batchSize" min="1" max="128" value="10">
            </div>
            
            <div class="form-group">
                <label for="learningRate" data-i18n="train_learning_rate_label">Learning Rate</label>
                <input type="number" id="learningRate" min="0.0001" max="0.1" step="0.0001" value="0.004">
            </div>
            
            <div class="form-group">
                <label for="loggingSteps" data-i18n="train_logging_steps_label">Logging Steps</label>
                <input type="number" id="loggingSteps" min="1" max="1000" value="40">
            </div>
            
            <div class="form-group">
                <label for="saveSteps" data-i18n="train_save_steps_label">Save Steps</label>
                <input type="number" id="saveSteps" min="100" max="5000" value="500">
                <small class="help-text" data-i18n="train_save_steps_help">Number of steps between checkpoint saves. Higher values save less frequently.</small>
            </div>
        </div>
    </div>

    <div class="card">
        <h2><i class="fas fa-database"></i> <span data-i18n="train_data_config">Training Data</span></h2>
        <div class="training-examples-container">
            <div class="training-examples-header">
                <h3 data-i18n="train_examples_label">Training Examples</h3>
                <button type="button" class="btn-primary add-example-btn" onclick="addTrainingExample()">
                    <i class="fas fa-plus"></i> <span data-i18n="add_example_btn">Add Example</span>
                </button>
            </div>
            
            <!-- Hidden JSON field to store the actual data -->
            <input type="hidden" id="trainingExamples">
            
            <!-- Examples will be dynamically added here -->
            <div id="trainingExamplesList" class="training-examples-list">
                <div class="empty-examples-message" data-i18n="no_examples_message">No training examples added yet. Click "Add Example" to add your first example.</div>
            </div>
        </div>
    </div>

    <div class="card">
        <!-- 训练配置导入选择 -->
        <div class="form-groups-container">
            <div class="form-group">
                <label for="trainConfigSelect" data-i18n="config_select_label">Import Training Configuration</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="trainConfigSelect" style="flex: 1;">
                        <option value="" data-i18n="config_select_placeholder">-- Select a training configuration --</option>
                        <!-- 配置选项将通过JavaScript动态加载 -->
                    </select>
                    <button class="btn-secondary" onclick="importSelectedTrainConfig()">
                        <i class="fas fa-download"></i> <span data-i18n="import_config_btn">Import</span>
                    </button>
                </div>
                <small class="help-text" data-i18n="train_config_select_help">Select and import a pre-configured training setup.</small>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="startTraining()">
                <i class="fas fa-play"></i> <span data-i18n="train_start_btn">Start Training</span>
            </button>
            <button class="btn-secondary" onclick="resetTrainForm()">
                <i class="fas fa-redo"></i> <span data-i18n="reset_btn">Reset</span>
            </button>
            <button class="btn-warning" onclick="restartBackend()">
                <i class="fas fa-sync-alt"></i> <span data-i18n="restart_backend_btn">Restart Backend</span>
            </button>
        </div>
    </div>

    <div id="trainResponse" class="response-container" style="display: none;">
        <h3><i class="fas fa-check-circle"></i> <span data-i18n="train_response_title">Training Result</span></h3>
        <div id="trainResponseContent"></div>
    </div>

    <div id="trainError" class="error-container" style="display: none;">
        <h3><i class="fas fa-exclamation-circle"></i> <span data-i18n="error_title">Error Message</span></h3>
        <pre id="trainErrorContent"></pre>
    </div>
    
    <!-- Template for new training example -->
    <template id="trainingExampleTemplate">
        <div class="training-example-item">
            <div class="example-header">
                <span class="example-number"></span>
                <button type="button" class="btn-danger remove-example-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="example-content">
                <div class="example-input">
                    <label data-i18n="example_input_label">Input:</label>
                    <textarea class="example-input-text" rows="3" onchange="updateTrainingExamples()" data-i18n-placeholder="example_input_placeholder" placeholder="Enter input text..."></textarea>
                </div>
                <div class="example-output">
                    <label data-i18n="example_output_label">Output:</label>
                    <textarea class="example-output-text" rows="3" onchange="updateTrainingExamples()" data-i18n-placeholder="example_output_placeholder" placeholder="Enter expected output..."></textarea>
                </div>
            </div>
        </div>
    </template>
</main> 